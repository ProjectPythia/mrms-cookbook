{"version":2,"kind":"Notebook","sha256":"f0c569d661ed4704f40f7a547f74c87c2c843a651f3dae47a938f53c4235b460","slug":"notebooks.bnf-mrms-qpe-hourly","location":"/notebooks/bnf-mrms-qpe-hourly.ipynb","dependencies":[],"frontmatter":{"title":"NOAA Multi-Radar / Multi-Sensor System (MRMS) at the BNF Field Site(s)","content_includes_title":true,"authors":[{"nameParsed":{"literal":"Ty Janoski","given":"Ty","family":"Janoski"},"name":"Ty Janoski","orcid":"0000-0003-4344-355X","affiliations":["City College of New York and NOAA/OAR National Severe Storms Laboratory"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Mya Sears","given":"Mya","family":"Sears"},"name":"Mya Sears","orcid":"0009-0003-5870-7498","affiliations":["NSF National Center for Atmospheric Research"],"id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Bella Condo","given":"Bella","family":"Condo"},"name":"Bella Condo","orcid":"0009-0000-0688-7077","affiliations":["University at Albany (State University of New York)"],"id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"JD Heaton","given":"JD","family":"Heaton"},"name":"JD Heaton","orcid":"0009-0005-7424-4889","affiliations":["Metropolitan State University of Denver"],"id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"MaKenna Collins","given":"MaKenna","family":"Collins"},"name":"MaKenna Collins","orcid":"0009-0003-5566-3370","affiliations":["Jackson State University"],"id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","affiliations":["Argonne National Laboratory"],"id":"contributors-myst-generated-uid-5"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/mrms-cookbook","copyright":"2025","affiliations":[{"id":"City College of New York and NOAA/OAR National Severe Storms Laboratory","name":"City College of New York and NOAA/OAR National Severe Storms Laboratory"},{"id":"NSF National Center for Atmospheric Research","name":"NSF National Center for Atmospheric Research"},{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"Metropolitan State University of Denver","name":"Metropolitan State University of Denver"},{"id":"Jackson State University","name":"Jackson State University"},{"id":"Argonne National Laboratory","name":"Argonne National Laboratory"},{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"edit_url":"https://github.com/projectpythia/mrms-cookbook/blob/main/notebooks/bnf-mrms-qpe-hourly.ipynb","thumbnail":"/mrms-cookbook/build/arm_logo-a827a0231196d26c1f8700c67443e353.png","exports":[{"format":"ipynb","filename":"bnf-mrms-qpe-hourly.ipynb","url":"/mrms-cookbook/build/bnf-mrms-qpe-hourly-fda92e674ed8d2891b419cc7fd53422e.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/mrms-cookbook/build/arm_logo-a827a0231196d26c1f8700c67443e353.png","alt":"ARM Logo","width":"500px","align":"center","key":"CAYRcPHFoX","urlSource":"../thumbnails/arm_logo.png"}],"key":"d2I1PGthke"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"NOAA Multi-Radar / Multi-Sensor System (MRMS) at the BNF Field Site(s)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KVIh4P89nP"}],"identifier":"noaa-multi-radar-multi-sensor-system-mrms-at-the-bnf-field-site-s","label":"NOAA Multi-Radar / Multi-Sensor System (MRMS) at the BNF Field Site(s)","html_id":"noaa-multi-radar-multi-sensor-system-mrms-at-the-bnf-field-site-s","implicit":true,"key":"r4sIlpFpui"}],"key":"XzYgaAewPX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r0AdAGyuB9"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"PJC3Im7KI7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We’ll go through the steps of:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fMUCpNsZ05"}],"key":"eMe5urclcf"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Define our region of verification sites","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cYSKRf0FvP"}],"key":"cSDCJi3hcb"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Query and Load Data from MRMS Buckets on AWS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cmRUZGT8m2"}],"key":"bJERsqUY6m"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Create a Multi-Panel Display of QPE for the different sites","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Mm2yTleUmo"}],"key":"lRliMl2F6V"}],"key":"w49GU303bm"}],"key":"EUX1wIjxmY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JhBGleIsHV"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"rkyOJ68tDD"},{"type":"table","position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HFSbkws12n"}],"key":"gbuKTWNZLz"},{"type":"tableCell","header":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ypke6sdFTt"}],"key":"IIpwBjC3Gb"},{"type":"tableCell","header":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mUMbPRGRCp"}],"key":"wc5z0o8iV6"}],"key":"D0mVTzdRxL"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/cartopy/cartopy","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Intro to Cartopy","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rRxokAOxgH"}],"urlSource":"https://foundations.projectpythia.org/core/cartopy/cartopy","key":"clXQH8QWAk"}],"key":"iWDTL2rd8y"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jiSQzaMZGN"}],"key":"OOzECUIeFt"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Mapping and Tiles","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KJ27JbM4Px"}],"key":"O4aLAGVW28"}],"key":"fDKMdl011T"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Intro to Xarray","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"k8ybPedUCy"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro/","key":"uptweeqQIz"}],"key":"jfrfFr2VwY"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"onz8ZTvS0W"}],"key":"KYuUZ1cb8c"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fG7QjX5ixN"}],"key":"NrHSY2m6q1"}],"key":"zBKrzvllPp"}],"key":"idJPgPWRsw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NyLTzsw8xy"}],"key":"G2yGIqywff"},{"type":"text","value":": 30 minutes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"cInhGwcxWi"}],"key":"qfw7URuebq"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"System requirements","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"PfBsERSpxM"}],"key":"JS2y2aXzHt"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"YGAnAQtWKu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Any Operating System","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"hZDUTtIeER"}],"key":"iXA8nePgKA"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"At least 8 GB of RAM","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"yKE6o8YqYt"}],"key":"ZQb0JdnjPT"}],"key":"EqKrXxB9Mm"}],"key":"CJAzpBQs9q"}],"key":"aYYGDv76PM"}],"key":"Bjh4ejrXPG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iHUZSkAfOg"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"pnzFg5ykAS"}],"key":"skIL6FDWzN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cfgrib\nimport xarray as xr\nimport fsspec\nimport glob\nimport tempfile\nimport gzip\nimport geopandas as gpd\nimport pandas as pd\nimport numpy as np\nimport warnings\n\nfrom cartopy import feature as cfeature\nimport cartopy.crs as ccrs\nfrom cartopy.io.img_tiles import OSM\nfrom matplotlib.transforms import offset_copy\nfrom matplotlib import pyplot as plt\n\nfrom metpy.plots import USCOUNTIES\n\nimport cmweather\n\n# To ignore all RuntimeWarnings globally\nwarnings.filterwarnings(\"ignore\", category=RuntimeWarning)","key":"gky5g3LqRg"},{"type":"output","id":"xSFe3vdWkBKtW9mocOFmK","data":[],"key":"hoa6cXvcac"}],"key":"cD3r81IB95"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Hourly QPE BNF Mosaic","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xht2eFdqdp"}],"identifier":"hourly-qpe-bnf-mosaic","label":"Hourly QPE BNF Mosaic","html_id":"hourly-qpe-bnf-mosaic","implicit":true,"key":"mFHq8bnbNn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ABDCneRJQi"},{"type":"link","url":"https://www.nssl.noaa.gov/projects/mrms/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"NOAA Multi-Radar / Multi-Sensor System (MRMS)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f6TmitbBMK"}],"urlSource":"https://www.nssl.noaa.gov/projects/mrms/","key":"u0zPFp0Zpu"},{"type":"text","value":" was created to produce products of preciptiation impacts on transportation and aviation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JA3Y8rsJPj"}],"key":"uC22hN5lbC"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fX2stzDCT1"},{"type":"link","url":"https://aws.amazon.com/marketplace/pp/prodview-6odvdc4md2jjc","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"NOAA MRMS AWS Bucket","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"m70hfdAR1h"}],"urlSource":"https://aws.amazon.com/marketplace/pp/prodview-6odvdc4md2jjc","key":"M3WZokHFLE"},{"type":"text","value":", this notebook details creation of quicklooks to investigate a Quantitative Preciptiation Estimates (QPE) for the U.S. Department of Energy Atmospheric Radiation Measurement (ARM) AMF-3 Deployment to Bankhead National Forest.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hEQmQcT5Kc"}],"key":"sHp08mSqlW"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"We start first with a dictionary containing our sites of interest, these are located Southwest of Decatur, Alabama.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sPxucsfgMA"}],"key":"tC2hwmkFXI"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"More about the BNF Site can be found on the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MjwzqRVABg"},{"type":"link","url":"https://www.arm.gov/capabilities/observatories/bnf","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"ARM Website","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"WqWYPFntZ0"}],"urlSource":"https://www.arm.gov/capabilities/observatories/bnf","key":"NyCMiayPZZ"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"aeYefwQ3Sr"}],"key":"lWb0QysvMg"}],"key":"eCa6dxEIFu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"global_sites = {\"M1\" : [34.34525, -87.33842],\n                \"S4\" : [34.46451, -87.23598],\n                \"S3\" : [34.63080, -87.13311],\n                \"S20\" : [34.65401, -87.29264],\n                \"S30\" : [34.38501, -86.92757],\n                \"S40\" : [34.17932, -87.45349]}\n\n\n# Define a domain to set the extent of the figures\nbnf_domain = [272.0, 274.0, 34.1, 35.1]","key":"THAP2H9Cno"},{"type":"output","id":"m7qQFNI1CyuId5lI6kljr","data":[],"key":"Me9JZbpeLO"}],"key":"nr6nG40bzg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the Site Locations Using Cartopy","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PQFKIeL3q0"}],"identifier":"visualize-the-site-locations-using-cartopy","label":"Visualize the Site Locations Using Cartopy","html_id":"visualize-the-site-locations-using-cartopy","implicit":true,"key":"rApJpfehUW"}],"key":"DIH9784eTL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(12,8))\nax = plt.subplot(projection=ccrs.PlateCarree())\n\ntiler = OSM()\nax.add_image(tiler, 12, zorder=0, alpha=0.7)\nfor site in global_sites:\n    ax.scatter(global_sites[site][1], global_sites[site][0], label=site)\n\nax.set_extent(bnf_domain)\n\nplt.legend(loc=\"upper right\")\nplt.title(\"ARM Bankhead National Forest Sites\", fontsize=16);","key":"hJIxeFldRN"},{"type":"output","id":"U_JxONyFLCvlCtlo9EsT2","data":[],"key":"O0MRcHgFW5"}],"key":"nBXXWj7mCS"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Query and Load Data from MRMS Buckets on AWS","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Hqy90ZAoeV"}],"identifier":"query-and-load-data-from-mrms-buckets-on-aws","label":"Query and Load Data from MRMS Buckets on AWS","html_id":"query-and-load-data-from-mrms-buckets-on-aws","implicit":true,"key":"rC8d0n3GtP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note the Multi-Sensor (i.e. gauge adjusted) QPE product is split into two categories (Pass 1 and Pass 2), which defines the gauge latency used to adjust radar dervied QPE.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vpv9N6CMej"}],"key":"RYNMFWDdau"}],"key":"tVI4zVSSyE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define a Date for Analysis [YYYYMMDD format]\nDATE = \"20250524\"\nHOUR = \"000000\"","key":"rHT3rPVbQ9"},{"type":"output","id":"RwKwvoSY6sC_NYvC8Sz5W","data":[],"key":"qvt7C9tHPk"}],"key":"MWIsamfFdR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Setup the AWS S3 filesystem\nfs = fsspec.filesystem(\"s3\", anon=True)","key":"BO3lo1coYX"},{"type":"output","id":"7-VuZGjGng1jW47kAQcXC","data":[],"key":"nk8ht71TPd"}],"key":"vi8b8oxz34"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3_multi_bucket = [f\"s3://noaa-mrms-pds/CONUS/MultiSensor_QPE_01H_Pass1_00.00/{DATE}/*.gz\"]\ns3_pass2_bucket = [f\"s3://noaa-mrms-pds/CONUS/MultiSensor_QPE_01H_Pass2_00.00/{DATE}/*.gz\"]\ns3_radar_bucket = [f\"s3://noaa-mrms-pds/CONUS/RadarOnly_QPE_01H_00.00/{DATE}/*[0-9]0000.grib2.gz\"]","key":"fbLsBEeURm"},{"type":"output","id":"bra_Bs7nACqFvk3s8XdJo","data":[],"key":"Q729NmS0kE"}],"key":"e3etGh7K58"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Loop through and Create Lists of Datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BNwdESPE44"}],"identifier":"loop-through-and-create-lists-of-datasets","label":"Loop through and Create Lists of Datasets","html_id":"loop-through-and-create-lists-of-datasets","implicit":true,"key":"aTqlW6xoW4"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Our next step is to search, access, and load our data into merged datasets, adding some additional metadata such as units. We apply this for each our our multipass, pass2, and radar datasets.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RJLU3QxSOb"}],"key":"T06ktOiaqN"}],"key":"VVnLsorVIy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_multi_list = []\nfor scan in s3_multi_bucket:\n    file_path = sorted(fs.glob(scan))\n    for mrms in file_path:\n        with fs.open(mrms, 'rb') as gzip_file:\n            with tempfile.NamedTemporaryFile(suffix=\".grib2\") as f:\n                # Uncompress and read the file\n                f.write(gzip.decompress(gzip_file.read()))\n                ds = xr.load_dataset(f.name, decode_timedelta=False)\n                # Parameters are stored as 'unknown'; meta data in filename\n                ds = ds.rename({\"unknown\" : \"multisensor_qpe_1hr\"})\n                ds[\"multisensor_qpe_1hr\"].attrs[\"units\"] = \"mm\"\n                ds[\"multisensor_qpe_1hr\"].attrs[\"long_name\"] = \"Precipitation Accumulation (1-Hr latency)\"\n                # Subset for the desired bounding box and take out all missing values\n                ds = ds.sel(latitude=slice(bnf_domain[3], bnf_domain[2]), longitude=slice(bnf_domain[0], bnf_domain[1])).where(ds.multisensor_qpe_1hr > 0)\n                ds_multi_list.append(ds)","key":"yW9YVjA0kT"},{"type":"output","id":"UHU_nHLu2bU1HR0HW4gfI","data":[],"key":"wkq1yw8JCu"}],"key":"Knc8PiN1yl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_radar_list = []\nfor scan in s3_radar_bucket:\n    file_path = sorted(fs.glob(scan))\n    for mrms in file_path:\n        with fs.open(mrms, 'rb') as gzip_file:\n            with tempfile.NamedTemporaryFile(suffix=\".grib2\") as f:\n                # Uncompress and read the file\n                f.write(gzip.decompress(gzip_file.read()))\n                ds = xr.load_dataset(f.name, decode_timedelta=False)\n                ds = ds.rename({\"unknown\" : \"radar_qpe_1hr\"})\n                ds[\"radar_qpe_1hr\"].attrs[\"units\"] = \"mm\"\n                ds[\"radar_qpe_1hr\"].attrs[\"long_name\"] = \"Precipitation Accumulation\"\n                 # Subset for the desired bounding box and take out all missing values\n                ds = ds.sel(latitude=slice(bnf_domain[3], bnf_domain[2]), longitude=slice(bnf_domain[0], bnf_domain[1])).where(ds.radar_qpe_1hr > 0)\n                ds_radar_list.append(ds)","key":"Z3P4eWmcaa"},{"type":"output","id":"5vk1JpUrVUYDOOlrfL4cU","data":[],"key":"fOthZMlBQb"}],"key":"YEMcAWzrrl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_pass2_list = []\nfor scan in s3_pass2_bucket:\n    file_path = sorted(fs.glob(scan))\n    for mrms in file_path:\n        with fs.open(mrms, 'rb') as gzip_file:\n            with tempfile.NamedTemporaryFile(suffix=\".grib2\") as f:\n                # Uncompress and read the file\n                f.write(gzip.decompress(gzip_file.read()))\n                ds = xr.load_dataset(f.name, decode_timedelta=False)\n                ds = ds.rename({\"unknown\" : \"multisensor_qpe_pass2\"})\n                ds[\"multisensor_qpe_pass2\"].attrs[\"units\"] = \"mm\"\n                ds[\"multisensor_qpe_pass2\"].attrs[\"long_name\"] = \"Precipitation Accumulation (2-Hr latency)\"\n                # Subset for the desired bounding box and take out all missing values\n                ds = ds.sel(latitude=slice(bnf_domain[3], bnf_domain[2]), longitude=slice(bnf_domain[0], bnf_domain[1])).where(ds.multisensor_qpe_pass2 > 0)\n                ds_pass2_list.append(ds)","key":"JkwkJPf7Co"},{"type":"output","id":"Ts5PyLE0bXm6aAn9qn0Bd","data":[],"key":"BHlSrHBWLR"}],"key":"EbZLecOFF2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Merge our Files Together","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gTxVWRvmbr"}],"identifier":"merge-our-files-together","label":"Merge our Files Together","html_id":"merge-our-files-together","implicit":true,"key":"RFkb5RLdPR"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Once we have lists of files, we can merge based on the time dimension.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nvA4OU0OnD"}],"key":"P57ZGkgMwz"}],"key":"ODW0dB1nVT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Concatenate all hourly files into xarray datasets\nds_radar_merged = xr.concat(ds_radar_list, dim=\"time\")\nds_multi_merged = xr.concat(ds_multi_list, dim=\"time\")\nds_pass2_merged = xr.concat(ds_pass2_list, dim=\"time\")","key":"iikUzTAEEo"},{"type":"output","id":"uOa1UCvI-78FYMMuPeAzr","data":[],"key":"VUBWBSwmjC"}],"key":"VtmX9NpwWt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"And finally merge our various passes and QPE data into one single dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MxFivyPiHt"}],"key":"gwAnWrUe8A"}],"key":"dqvMsmTPn1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Merge Radar, Multi-Sensor Pass 1 and Multi-Sensor Pass 2 QPE into single dataset\nds_merged = xr.merge([ds_radar_merged, ds_multi_merged, ds_pass2_merged])","key":"I5J4yiksOh"},{"type":"output","id":"Aam9ebpzCKxdfzZeo7csn","data":[],"key":"ALNDupDrlh"}],"key":"BoAgFhXBih"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate Precipitation Accumulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K2QBJk2z8e"}],"identifier":"calculate-precipitation-accumulation","label":"Calculate Precipitation Accumulation","html_id":"calculate-precipitation-accumulation","implicit":true,"key":"cCytT8crdb"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Our last step is to calculate our preciptiation accumulation as observed from radar data. We do this by using the xarray cumulative sum ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zRUV5xmvjD"},{"type":"link","url":"https://docs.xarray.dev/en/latest/generated/xarray.DataArray.cumsum.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"cumsum","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lh4WzI102x"}],"urlSource":"https://docs.xarray.dev/en/latest/generated/xarray.DataArray.cumsum.html","key":"i5mslwrhJg"},{"type":"text","value":" function.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HOXUHjj4SA"}],"key":"uXqVVIXCRV"}],"key":"kaLGfdHeXx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate the Cumulative Distribution\nradar_cumulative = ds_merged['radar_qpe_1hr'].cumsum(dim='time')\nmultisensor = ds_merged['multisensor_qpe_1hr'].cumsum(dim=\"time\")\nmultisensor_pass2 = ds_merged['multisensor_qpe_pass2'].cumsum(dim=\"time\")\n\nds_merged['cumulative_radar_qpe'] = radar_cumulative\nds_merged[\"cumulative_radar_qpe\"].attrs[\"units\"] = \"mm\"\nds_merged[\"cumulative_radar_qpe\"].attrs[\"long_name\"] = \"Precipitation Accumulation\"\n\nds_merged['cumulative_multisensor'] = multisensor\nds_merged[\"cumulative_multisensor\"].attrs[\"units\"] = \"mm\"\nds_merged[\"cumulative_multisensor\"].attrs[\"long_name\"] = \"Precipitation Accumulation (1-Hr latency)\"\n\nds_merged['cumulative_ms_pass2'] = multisensor_pass2\nds_merged[\"cumulative_ms_pass2\"].attrs[\"units\"] = \"mm\"\nds_merged[\"cumulative_ms_pass2\"].attrs[\"long_name\"] = \"Precipitation Accumulation (2-Hr latency)\"\nds_merged","key":"eyu06zynOs"},{"type":"output","id":"962vRNNzICoBD70xLFkj8","data":[],"key":"Md56rVyJiV"}],"key":"Xm1LFrnNEw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a Multi-Panel QPE Display","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jFcbd1w6iC"}],"identifier":"create-a-multi-panel-qpe-display","label":"Create a Multi-Panel QPE Display","html_id":"create-a-multi-panel-qpe-display","implicit":true,"key":"DCTpVjv6Hp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now that we have our merged, cleaned data, we can create a single graphic summarizing the cumulative precipitation at our different sites. We use nearest neighbor here to subset from the broader region.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ak67CieGBj"}],"key":"z4GJYpiHkR"}],"key":"Zxp0DCZya0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#---------------------------------------------------\n# Define the Figure for Detailed Subplot Placement\n#---------------------------------------------------\nfig = plt.figure(figsize=(24, 10))\ntiler = OSM()\nmercator = tiler.crs\nax = fig.add_subplot(1, 3, 1, projection=ccrs.PlateCarree())\n\n# adjust the subplot widths\nplt.subplots_adjust(wspace=0.3)\n\n# Find the maximum value at each position\nda_max = ds_merged.isel(time=-1).radar_qpe_1hr.max()\n\n# Find the minimum value at each position\nda_min = 0\n\n# ---------------------------------------------\n# Display the Radar Precipitation Accumulation\n# ---------------------------------------------\n\n## subset the data\nds_merged.isel(time=15).radar_qpe_1hr.plot(transform=ccrs.PlateCarree(),\n                                           ax=ax,\n                                           cmap=\"ChaseSpectral\",\n                                           vmin=da_min,\n                                           vmax=da_max,\n                                           cbar_kwargs={\"location\" : \"bottom\"})\n\n# Add some various map elements to the plot to make it recognizable.\nax.add_feature(cfeature.LAND)\nax.add_feature(cfeature.OCEAN)\nax.add_feature(cfeature.BORDERS)\nax.add_image(tiler, 12, zorder=1, alpha=0.55)\nax.gridlines(draw_labels=True)\n\n# Set plot bounds\nax.set_extent(bnf_domain)\n\n# add in crosshairs to indicate the lat/lon slices\nax.axhline(y=global_sites[\"M1\"][0], color=\"black\", linestyle=\"--\")\nax.axvline(x=global_sites[\"M1\"][1], color=\"red\", linestyle=\"--\")\n\n# Display the location of the BNF supplementarly sites\nfor key in global_sites:\n    # Add a marker for the BNF sites.\n    ax.plot(global_sites[key][1], \n            global_sites[key][0], \n            marker='o', \n            color='black', \n            markersize=10, \n            alpha=0.7, \n            transform=ccrs.PlateCarree())\n\n    # Use the cartopy interface to create a matplotlib transform object\n    # for the Geodetic coordinate system. We will use this along with\n    # matplotlib's offset_copy function to define a coordinate system which\n    # translates the text by 25 pixels to the left.\n    geodetic_transform = ccrs.PlateCarree()._as_mpl_transform(ax)\n    text_transform = offset_copy(geodetic_transform, units='dots', x=+50, y=+15)\n\n    # Add text to the right of the symbol.\n    ax.text(global_sites[key][1]-0.1, \n            global_sites[key][0], \n            key, \n            verticalalignment='center', \n            horizontalalignment='right', \n            transform=text_transform,\n            bbox=dict(facecolor='sandybrown', \n            alpha=0.5, \n            boxstyle='round'))\n    \n# update the title of the display\nax.set_title(np.datetime_as_string(ds_merged['valid_time'].isel(time=15).data, unit='s').replace(\"T\", \" - \") + \n             \"Z\\n\" + \"Radar Derived 1-Hr QPE - MRMS\")\n\n# ----------------------------\n# Display the Multisensor QPE\n# ----------------------------\n## subset the data\nax1 = fig.add_subplot(1, 3, 2, projection=ccrs.PlateCarree())\nds_merged.isel(time=15).multisensor_qpe_1hr.plot(transform=ccrs.PlateCarree(),\n                                                 ax=ax1,\n                                                 cmap=\"ChaseSpectral\",\n                                                 vmin=da_min,\n                                                 vmax=da_max,\n                                                 cbar_kwargs={\"location\" : \"bottom\"})\n\n# Add some various map elements to the plot to make it recognizable.\nax1.add_feature(cfeature.LAND)\nax1.add_feature(cfeature.OCEAN)\nax1.add_feature(cfeature.BORDERS)\nax1.add_image(tiler, 12, zorder=1, alpha=0.55)\nax1.gridlines(draw_labels=True)\n\n# Set plot bounds\nax1.set_extent(bnf_domain)\n\n# add in crosshairs to indicate the lat/lon slices\nax1.axhline(y=global_sites[\"M1\"][0], color=\"black\", linestyle=\"--\")\nax1.axvline(x=global_sites[\"M1\"][1], color=\"red\", linestyle=\"--\")\n\n# Display the location of the BNF Supplementary Site\nfor key in global_sites:\n    # Add a marker for the BNF sites.\n    ax1.plot(global_sites[key][1], \n            global_sites[key][0], \n            marker='o', \n            color='black', \n            markersize=10, \n            alpha=0.7, \n            transform=ccrs.PlateCarree())\n\n    # Use the cartopy interface to create a matplotlib transform object\n    # for the Geodetic coordinate system. We will use this along with\n    # matplotlib's offset_copy function to define a coordinate system which\n    # translates the text by 25 pixels to the left.\n    geodetic_transform = ccrs.PlateCarree()._as_mpl_transform(ax1)\n    text_transform = offset_copy(geodetic_transform, units='dots', x=+50, y=+15)\n\n\n    # Add text to the right of the site marker.\n    ax1.text(global_sites[key][1]-0.1, \n             global_sites[key][0], \n             key, \n             verticalalignment='center', \n             horizontalalignment='right', \n             transform=text_transform,\n             bbox=dict(facecolor='sandybrown', \n             alpha=0.5, \n             boxstyle='round')\n    )\n    \n# update the title of the display\nax1.set_title(np.datetime_as_string(ds_merged['valid_time'].isel(time=15).data, unit='s').replace(\"T\", \" - \") + \n             \"Z\\n\" + \"Multisensor 1-Hr QPE - Pass 1\")\n\n# ----------------------------\n# Display the QPE Difference\n# ----------------------------\n## subset the data\nax3 = fig.add_subplot(1, 3, 3, projection=ccrs.PlateCarree())\nds_merged.isel(time=15).multisensor_qpe_pass2.plot(transform=ccrs.PlateCarree(),\n                                                   ax=ax3,\n                                                   cmap=\"ChaseSpectral\",\n                                                   vmin=da_min,\n                                                   vmax=da_max,\n                                                   cbar_kwargs={\"location\" : \"bottom\"})\n\n# Add some various map elements to the plot to make it recognizable.\nax3.add_feature(cfeature.LAND)\nax3.add_feature(cfeature.OCEAN)\nax3.add_feature(cfeature.BORDERS)\nax3.add_image(tiler, 12, zorder=1, alpha=0.55)\nax3.gridlines(draw_labels=True)\n\n# Set plot bounds\nax3.set_extent(bnf_domain)\n\n# add in crosshairs to indicate the lat/lon slices\nax3.axhline(y=global_sites[\"M1\"][0], color=\"black\", linestyle=\"--\")\nax3.axvline(x=global_sites[\"M1\"][1], color=\"red\", linestyle=\"--\")\n\n# Display the location of the BNF Supplementary Sites\nfor key in global_sites:\n    # Add a marker for the BNF sites.\n    ax3.plot(global_sites[key][1], \n            global_sites[key][0], \n            marker='o', \n            color='black', \n            markersize=10, \n            alpha=0.7, \n            transform=ccrs.PlateCarree())\n\n    # Use the cartopy interface to create a matplotlib transform object\n    # for the Geodetic coordinate system. We will use this along with\n    # matplotlib's offset_copy function to define a coordinate system which\n    # translates the text by 25 pixels to the left.\n    geodetic_transform = ccrs.PlateCarree()._as_mpl_transform(ax3)\n    text_transform = offset_copy(geodetic_transform, units='dots', x=+50, y=+15)\n\n    # Add text to the right of the site marker.\n    ax3.text(global_sites[key][1]-0.1, \n             global_sites[key][0], \n             key, \n             verticalalignment='center', \n             horizontalalignment='right', \n             transform=text_transform,\n             bbox=dict(facecolor='sandybrown', \n             alpha=0.5, \n             boxstyle='round'))\n    \n# update the title of the display\nax3.set_title(np.datetime_as_string(ds_merged['valid_time'].isel(time=15).data, unit='s').replace(\"T\", \" - \") + \n             \"Z\\n\" + \"MultiSensor 24-Hr QPE - Pass 2\");","key":"EsUXIsKTIu"},{"type":"output","id":"vq6zkT_0vbgjuESkeVxiy","data":[],"key":"VDrExKDhiH"}],"key":"GRIFZFenra"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rCKCtKwAdU"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"tWlJ0AYkrt"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Within this notebook, we explored plotting a set of a field sites, accessing MRMS data, and visualizing a case over the ARM DOE Bankhead National Forest field site. We hope this serves as a framework for verification and understanding precipitation values in specific regions of interest.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RjNmeEN5KJ"}],"key":"o4qjyniIre"},{"type":"heading","depth":3,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s Next","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PYcZJIG6IG"}],"identifier":"whats-next","label":"What’s Next","html_id":"whats-next","implicit":true,"key":"pgRBvmsTbH"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We can extend this workflow by investigating timeseries for the various sites and looking into more robust verification techniques.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"B8TEd7Wwlp"}],"key":"SomO2l5GiW"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WjyRnQ5rqw"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"pm9TJabhdP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"link","url":"https://github.com/ARM-Development/bnf-radar-examples/blob/main/notebooks/bnf-mrms-qpe-hourly.ipynb","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Notebook originally modified from Joseph O’Brien","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LHL4oazWM2"}],"urlSource":"https://github.com/ARM-Development/bnf-radar-examples/blob/main/notebooks/bnf-mrms-qpe-hourly.ipynb","data":{"kind":"file","org":"ARM-Development","repo":"bnf-radar-examples","reference":"main","file":"notebooks/bnf-mrms-qpe-hourly.ipynb","raw":"https://raw.githubusercontent.com/ARM-Development/bnf-radar-examples/main/notebooks/bnf-mrms-qpe-hourly.ipynb"},"internal":false,"protocol":"github","key":"y0z1pb1EF1"}],"key":"LYQDtQ9WeU"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://registry.opendata.aws/noaa-mrms-pds","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"NOAA Multi-Radar/Multi-Sensor System (MRMS) was accessed on from https://registry.opendata.aws/noaa-mrms-pds","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"yjOs895sj3"}],"urlSource":"https://registry.opendata.aws/noaa-mrms-pds","key":"UXs8qVlr1a"}],"key":"EpglEqd37c"}],"key":"hpRw1sb7l5"}],"key":"lcl9TLjwki"}],"key":"PNcNIf2IhD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 3: July 2025 Central TX Floods","url":"/notebooks/ch3-txfloods","group":"MRMS Cookbook"},"next":{"title":"Chapter 5: Real-time MRMS Visualization","url":"/notebooks/ch4-realtimedata","group":"MRMS Cookbook"}}},"domain":"http://localhost:3000"}